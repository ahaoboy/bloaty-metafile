bloaty-metafile is a cli tool to convert csv files generated by [bloaty](https://github.com/google/bloaty) to esbuild's [metafile](https://esbuild.github.io/api/#metafile) format, so that you can use [online tools](https://esbuild.github.io/analyze/) to analyze the size of the program

```bash
cargo binstall bloaty-metafile

cargo install --git https://github.com/ahaoboy/bloaty-metafile

bloaty ./bloaty -d sections,symbols -n 0  --csv | bloaty-metafile > meta.json

bloaty ./target/release/bloaty-metafile -d sections,symbols -n 0  --csv | bloaty-metafile --name=bloaty-metafile --lock=Cargo.lock  > meta.json
```

## profile

In order for bloaty to parse symbol information properly, it is recommended to keep debug information and turn off lto and strip

```toml
debug = true
lto = false
strip = false
```

## csv format

Please make sure bloaty generates a csv file in the following format. If the program is too large and the generated json exceeds 100mb, use the -n parameter to reduce the amount of data.

```
sections,symbols,vmsize,filesize
.text,ossl_aes_gcm_encrypt_avx512,337642,337642
.text,ossl_aes_gcm_decrypt_avx512,337638,337638
```

## Esbuild Bundle Size Analyzer

https://esbuild.github.io/analyze/

## lock file

Because bloaty's output does not include crate dependency information, the sizes of crates are all displayed separately.

![llrt](https://github.com/user-attachments/assets/669c033f-72e8-49e9-b030-dffc370b6580)

If a lock file can be provided, by default, the Cargo.lock file in the current directory is used. the dependency size can be correctly displayed by analyzing the crate dependencies.

![llrt](https://github.com/user-attachments/assets/756bb69e-d8b5-42b2-946f-8e5439284209)

